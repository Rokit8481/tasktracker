{% extends "base.html" %}

{% block title %}–ì–æ–ª–æ–≤–Ω–∞{% endblock title %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- –°–∞–π–¥–±–∞—Ä –∑ –¥–æ—à–∫–∞–º–∏ -->
    <div class="col-md-3 border-end">
      <div class="d-flex justify-content-between align-items-center mt-3">
        <h5>–î–æ—à–∫–∏</h5>
        <a href="{% url 'dashboard_create' %}" class="btn btn-sm btn-success">+</a>
      </div>
      <ul class="list-group mt-2">
        {% for d in dashboards %}
          <li class="list-group-item {% if selected_dashboard and d.id == selected_dashboard.id %}active{% endif %}">
            <a href="?dashboard={{ d.id }}" class="text-decoration-none {% if selected_dashboard and d.id == selected_dashboard.id %}text-white{% endif %}">
              {{ d.title }}
            </a>
          </li>
        {% empty %}
          <li class="list-group-item text-muted">–ù–µ–º–∞—î –¥–æ—à–æ–∫</li>
        {% endfor %}
      </ul>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å–ø—Ä–∞–≤–∞ -->
    <div class="col-md-9">
      {% if selected_dashboard %}
        <!-- –°–ø–∏—Å–∫–∏ -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <h4>–°–ø–∏—Å–∫–∏: {{ selected_dashboard.title }}</h4>
          <a href="{% url 'todolist_create' dashboard_pk=selected_dashboard.id %}" class="btn btn-sm btn-success">+ –î–æ–¥–∞—Ç–∏ —Å–ø–∏—Å–æ–∫</a>
        </div>
        <div class="d-flex flex-wrap gap-2 mb-3 mt-2">
          {% for tl in todolists %}
            <a href="?dashboard={{ selected_dashboard.id }}&todolist={{ tl.id }}"
               class="btn {% if selected_todolist and tl.id == selected_todolist.id %}btn-primary{% else %}btn-outline-primary{% endif %}">
              {{ tl.title }}
            </a>
          {% empty %}
            <span class="text-muted">–ù–µ–º–∞—î —Å–ø–∏—Å–∫—ñ–≤</span>
          {% endfor %}
        </div>
      {% endif %}

      {% if selected_todolist %}
        <!-- –ó–∞–≤–¥–∞–Ω–Ω—è -->
        <div class="d-flex justify-content-between align-items-center">
          <h5>–ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è: {{ selected_todolist.title }}</h5>
          <a href="{% url 'task_create' dashboard_pk=selected_dashboard.id todolist_pk=selected_todolist.id %}" class="btn btn-sm btn-success">+ –î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
        </div>

        <div class="row mt-3">
          {% for key, col_title in columns.items %}
            <div class="col-md-3">
              <div class="card shadow-sm">
                <div class="card-header text-center fw-bold">{{ col_title }}</div>
                <ul class="list-group list-group-flush">
                  {% for task in tasks %}
                    {% if task.status == key %}
                      <li class="list-group-item">
                        <div class="d-flex justify-content-between">
                          <span>{{ task.title }}</span>
                          <a href="{% url 'comment_create' dashboard_pk=selected_dashboard.id todolist_pk=selected_todolist.id task_pk=task.id %}" class="btn btn-sm btn-outline-secondary">üí¨</a>
                        </div>
                        <p class="small text-muted">{{ task.content|truncatechars:50 }}</p>
                      </li>
                    {% endif %}
                  {% empty %}
                    <li class="list-group-item text-muted">–ù–µ–º–∞—î –∑–∞–≤–¥–∞–Ω—å</li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          {% endfor %}
        </div>
      {% elif selected_dashboard %}
        <p class="text-muted">–û–±–µ—Ä—ñ—Ç—å —Å–ø–∏—Å–æ–∫, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è.</p>
      {% else %}
        <p class="text-muted">–û–±–µ—Ä—ñ—Ç—å –¥–æ—à–∫—É, —â–æ–± –ø–æ—á–∞—Ç–∏.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
